version: '3.8'

services:
  mothership:
    build: 
      context: .
      dockerfile: Dockerfile.mothership
    ports:
      - "8080:8080"
    environment:
      - NODE_ENV=development
    volumes:
      - .:/workspace
      - /var/run/docker.sock:/var/run/docker.sock
    working_dir: /workspace
    command: npm run mothership

  node-build:
    build:
      context: .
      dockerfile: Dockerfile.node
    volumes:
      - .:/workspace
      - node_modules:/workspace/node_modules
    working_dir: /workspace
    command: tail -f /dev/null
    environment:
      - NODE_ENV=development
    depends_on:
      - mothership

  web-build:
    build:
      context: .
      dockerfile: Dockerfile.web
    volumes:
      - .:/workspace
      - web_build_node_modules:/workspace/node_modules
    working_dir: /workspace
    command: tail -f /dev/null
    environment:
      - NODE_ENV=development
    depends_on:
      - mothership

  golang-build:
    build:
      context: .
      dockerfile: Dockerfile.golang
    volumes:
      - .:/workspace
    working_dir: /workspace
    command: tail -f /dev/null
    environment:
      - GOPATH=/workspace
    depends_on:
      - mothership

  python-build:
    build:
      context: .
      dockerfile: Dockerfile.python
    volumes:
      - .:/workspace
    working_dir: /workspace
    command: tail -f /dev/null
    environment:
      - PYTHONPATH=/workspace
    depends_on:
      - mothership

volumes:
  node_modules:
  web_build_node_modules:
