version: '3.8'
services:
  chromium:
    image: browserless/chrome:latest
    container_name: chromium
    restart: unless-stopped
    ports:
      - '4567:4567'
      - '9222:9222'
    shm_size: 2g
    environment:
      CONNECTION_TIMEOUT: '60000'
      MAX_CONCURRENT_SESSIONS: '10'
      ENABLE_CORS: 'true'
      REMOTE_DEBUGGING_PORT: '9222'
      REMOTE_DEBUGGING_ADDRESS: 0.0.0.0
      PORT: '4567'
    healthcheck:
      test:
        - CMD
        - curl
        - '-f'
        - http://localhost:4567/health
      interval: 10s
      timeout: 10s
      retries: 30
      start_period: 120s
    networks:
      - default
  aider-pool:
    image: paulgauthier/aider-full:latest
    restart: unless-stopped
    environment:
      PYTHONUNBUFFERED: '1'
      AIDER_POOL_HOST: 0.0.0.0
      AIDER_POOL_PORT: '8765'
      DEEPSEEK_API_KEY: sk-44ac90c2cca746e2b152dd3f97cbf36c
      GIT_AUTHOR_NAME: Testeranto Bot
      GIT_AUTHOR_EMAIL: bot@testeranto.local
      GIT_COMMITTER_NAME: Testeranto Bot
      GIT_COMMITTER_EMAIL: bot@testeranto.local
    networks:
      - default
    volumes:
      - /Users/adam/Code/testeranto:/workspace
      - node_modules:/workspace/node_modules
      - /var/run/docker.sock:/var/run/docker.sock
      - /Users/adam/Code/testeranto/.aider.conf.yml:/workspace/.aider.conf.yml:ro
    working_dir: /workspace
    ports:
      - '8765:8765'
      - 9000-9100:9000-9100
volumes:
  node_modules:
    driver: local
networks:
  default:
    name: allTests_network
